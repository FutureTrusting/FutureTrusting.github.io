---
layout:     post
title:      Redis
subtitle:   Redis
date:       2020-04-08
author:     Square
header-img: img/wallhaven-zm3mxw.jpg
catalog: true
tags:
    - Interview
---

## Redis  
##### 1、为什么要用 redis/为什么要用缓存  
高性能：操作缓存就是直接操作内存，所以速度相当快。如果数据库中的对应数据改变的之后，同步改变缓存中相应的数据即可！  
高并发：直接操作缓存能够承受的请求是远远大于直接访问数据库的，所以我们可以考虑把数据库中的部分数据转移到缓存中去。  
##### 2、为什么要用 redis 而不用 map/guava 做缓存?  
使用 redis 或 memcached 之类的称为分布式缓存，在多实例的情况下，各实例共用一份缓存数据，缓存具有一致性。  
缺点是需要保持 redis 或 memcached服务的高可用，整个程序架构上较为复杂。  
##### 3、redis 的线程模型  
redis叫做单线程的模型。它采用 IO 多路复用机制同时监听多个 socket  
文件事件处理器的结构包含 4 个部分： 
- 多个 socket  
- IO 多路复用程序  
- 文件事件分派器  
- 事件处理器（连接应答处理器、命令请求处理器、命令回复处理器）     

多个 socket 可能会并发产生不同的操作，每个操作对应不同的文件事件，但是 IO 多路复用程序会监听多个 socket，          
会将 socket 产生的事件放入队列中排队，事件分派器每次从队列中取出一个事件，把该事件交给对应的事件处理器进行处理。      

##### 4、redis 和 memcached 的区别     
1. redis支持更丰富的数据类型：Redis支持String,List,Set,Hash,ZSet(Sorted Set)等数据结构的存储。memcache支持String(二进制类型新增)数据类型，。     
2. Redis支持数据的持久化(RDB+AOF)，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用,而Memecache把数据全部存在内存之中。     
3. 集群模式：memcached没有原生的集群模式，需要依靠客户端来实现往集群中分片写入数据；但是 redis 目前是原生支持 cluster 模式的.     
4. Memcached是多线程，非阻塞IO复用的网络模型；Redis使用单线程的多路 IO 复用模型。         

##### 5、redis 设置过期时间          
定期删除+惰性删除。     
- 定期删除：redis默认是每隔 100ms 就随机抽取一些设置了过期时间的key，检查其是否过期，如果过期就删除。     
- 惰性删除 ：定期删除可能会导致很多过期 key 到了时间并没有被删除掉。所以就有了惰性删除。       
假如你的过期 key，靠定期删除没有被删除掉，还停留在内存里，除非你的系统去查一下那个 key，才会被redis给删除掉。        

##### 6、什么是缓存雪崩？     
缓存同一时间大面积的失效，所以，后面的请求都会落到数据库上，造成数据库短时间内承受大量请求而崩掉。     
- 事前：尽量保证整个 redis 集群的高可用性，发现机器宕机尽快补上。选择合适的内存淘汰策略。     
- 事中：本地ehcache缓存 + hystrix限流&降级，避免MySQL崩掉     
- 事后：利用 redis 持久化机制保存的数据尽快恢复缓存     

##### 7、缓存穿透     
缓存穿透说简单点就是大量请求的 key 根本不存在于缓存中，导致请求直接到了数据库上，根本没有经过缓存这一层。     
1）缓存无效 key : 如果缓存和数据库都查不到某个 key 的数据就写一个到 redis 中去并设置过期时间     
2）布隆过滤器    
    
    
    
    
    
    
    